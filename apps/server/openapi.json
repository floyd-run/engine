{
  "openapi": "3.1.0",
  "info": {
    "title": "Floyd Engine API",
    "version": "1.0.0",
    "description": "Booking engine for AI agents"
  },
  "servers": [
    {
      "url": "{baseUrl}",
      "description": "API Server",
      "variables": {
        "baseUrl": {
          "default": "https://api.floyd.run",
          "description": "Base URL for the Floyd Engine API"
        }
      }
    }
  ],
  "components": {
    "schemas": {
      "Ledger": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": ["id", "createdAt", "updatedAt"]
      },
      "Resource": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "timezone": {
            "type": ["string", "null"]
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": ["id", "ledgerId", "timezone", "createdAt", "updatedAt"]
      },
      "Allocation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "resourceId": {
            "type": "string"
          },
          "bookingId": {
            "type": ["string", "null"]
          },
          "active": {
            "type": "boolean"
          },
          "startTime": {
            "type": "string"
          },
          "endTime": {
            "type": "string"
          },
          "buffer": {
            "type": "object",
            "properties": {
              "beforeMs": {
                "type": "number"
              },
              "afterMs": {
                "type": "number"
              }
            },
            "required": ["beforeMs", "afterMs"]
          },
          "expiresAt": {
            "type": ["string", "null"]
          },
          "metadata": {
            "type": ["object", "null"],
            "additionalProperties": {}
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "ledgerId",
          "resourceId",
          "bookingId",
          "active",
          "startTime",
          "endTime",
          "buffer",
          "expiresAt",
          "metadata",
          "createdAt",
          "updatedAt"
        ]
      },
      "WebhookSubscription": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": ["id", "ledgerId", "url", "createdAt", "updatedAt"]
      },
      "AvailabilityItem": {
        "type": "object",
        "properties": {
          "resourceId": {
            "type": "string"
          },
          "timeline": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startTime": {
                  "type": "string"
                },
                "endTime": {
                  "type": "string"
                },
                "status": {
                  "type": "string",
                  "enum": ["free", "busy"]
                }
              },
              "required": ["startTime", "endTime", "status"]
            }
          }
        },
        "required": ["resourceId", "timeline"]
      },
      "TimelineBlock": {
        "type": "object",
        "properties": {
          "startTime": {
            "type": "string"
          },
          "endTime": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["free", "busy"]
          }
        },
        "required": ["startTime", "endTime", "status"]
      },
      "Slot": {
        "type": "object",
        "properties": {
          "startTime": {
            "type": "string"
          },
          "endTime": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["available", "unavailable"]
          }
        },
        "required": ["startTime", "endTime"]
      },
      "ResourceSlots": {
        "type": "object",
        "properties": {
          "resourceId": {
            "type": "string"
          },
          "timezone": {
            "type": "string"
          },
          "slots": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startTime": {
                  "type": "string"
                },
                "endTime": {
                  "type": "string"
                },
                "status": {
                  "type": "string",
                  "enum": ["available", "unavailable"]
                }
              },
              "required": ["startTime", "endTime"]
            }
          }
        },
        "required": ["resourceId", "timezone", "slots"]
      },
      "Window": {
        "type": "object",
        "properties": {
          "startTime": {
            "type": "string"
          },
          "endTime": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["available", "unavailable"]
          }
        },
        "required": ["startTime", "endTime"]
      },
      "ResourceWindows": {
        "type": "object",
        "properties": {
          "resourceId": {
            "type": "string"
          },
          "timezone": {
            "type": "string"
          },
          "windows": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startTime": {
                  "type": "string"
                },
                "endTime": {
                  "type": "string"
                },
                "status": {
                  "type": "string",
                  "enum": ["available", "unavailable"]
                }
              },
              "required": ["startTime", "endTime"]
            }
          }
        },
        "required": ["resourceId", "timezone", "windows"]
      },
      "Policy": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "config": {
            "type": "object",
            "additionalProperties": {}
          },
          "configHash": {
            "type": "string"
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": ["id", "ledgerId", "config", "configHash", "createdAt", "updatedAt"]
      },
      "Service": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "policyId": {
            "type": ["string", "null"]
          },
          "resourceIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "metadata": {
            "type": ["object", "null"],
            "additionalProperties": {}
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "ledgerId",
          "name",
          "policyId",
          "resourceIds",
          "metadata",
          "createdAt",
          "updatedAt"
        ]
      },
      "Booking": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "ledgerId": {
            "type": "string"
          },
          "serviceId": {
            "type": "string"
          },
          "policyId": {
            "type": ["string", "null"]
          },
          "status": {
            "type": "string",
            "enum": ["hold", "confirmed", "canceled", "expired"]
          },
          "expiresAt": {
            "type": ["string", "null"]
          },
          "allocations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "resourceId": {
                  "type": "string"
                },
                "startTime": {
                  "type": "string"
                },
                "endTime": {
                  "type": "string"
                },
                "buffer": {
                  "type": "object",
                  "properties": {
                    "beforeMs": {
                      "type": "number"
                    },
                    "afterMs": {
                      "type": "number"
                    }
                  },
                  "required": ["beforeMs", "afterMs"]
                },
                "active": {
                  "type": "boolean"
                }
              },
              "required": ["id", "resourceId", "startTime", "endTime", "buffer", "active"]
            }
          },
          "metadata": {
            "type": ["object", "null"],
            "additionalProperties": {}
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "ledgerId",
          "serviceId",
          "policyId",
          "status",
          "expiresAt",
          "allocations",
          "metadata",
          "createdAt",
          "updatedAt"
        ]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "details": {
                "type": "object",
                "additionalProperties": {}
              },
              "issues": {
                "type": "array",
                "items": {}
              }
            },
            "required": ["code", "message"]
          }
        },
        "required": ["error"]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/v1/ledgers": {
      "get": {
        "tags": ["Ledgers"],
        "summary": "List all ledgers",
        "responses": {
          "200": {
            "description": "List of ledgers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": ["id", "createdAt", "updatedAt"]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Ledgers"],
        "summary": "Create a new ledger",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {}
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Ledger created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "createdAt", "updatedAt"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{id}": {
      "get": {
        "tags": ["Ledgers"],
        "summary": "Get a ledger by ID",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "Ledger ID"
            },
            "required": true,
            "description": "Ledger ID",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Ledger details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "createdAt", "updatedAt"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Ledger not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/resources": {
      "get": {
        "tags": ["Resources"],
        "summary": "List all resources in a ledger",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of resources",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "timezone": {
                            "type": ["string", "null"]
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": ["id", "ledgerId", "timezone", "createdAt", "updatedAt"]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Resources"],
        "summary": "Create a new resource",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "timezone": {
                    "type": ["string", "null"],
                    "description": "IANA timezone for the resource (e.g. America/New_York)",
                    "example": "America/New_York"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Resource created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "timezone": {
                          "type": ["string", "null"]
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "ledgerId", "timezone", "createdAt", "updatedAt"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/resources/{id}": {
      "get": {
        "tags": ["Resources"],
        "summary": "Get a resource by ID",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Resource details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "timezone": {
                          "type": ["string", "null"]
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "ledgerId", "timezone", "createdAt", "updatedAt"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Resources"],
        "summary": "Delete a resource",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "Resource deleted"
          },
          "404": {
            "description": "Resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/availability": {
      "post": {
        "tags": ["Availability"],
        "summary": "Query resource availability",
        "description": "Returns a timeline of free/busy blocks for the specified resources within the given time window. Overlapping and adjacent allocations are merged into single busy blocks.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "resourceIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Resource IDs to query",
                    "example": ["rsc_01abc123def456ghi789jkl012"]
                  },
                  "startTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Start of the time window (ISO 8601)",
                    "example": "2026-01-04T10:00:00Z"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "End of the time window (ISO 8601)",
                    "example": "2026-01-04T18:00:00Z"
                  }
                },
                "required": ["resourceIds", "startTime", "endTime"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Availability timeline for each resource",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "resourceId": {
                            "type": "string"
                          },
                          "timeline": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "startTime": {
                                  "type": "string"
                                },
                                "endTime": {
                                  "type": "string"
                                },
                                "status": {
                                  "type": "string",
                                  "enum": ["free", "busy"]
                                }
                              },
                              "required": ["startTime", "endTime", "status"]
                            }
                          }
                        },
                        "required": ["resourceId", "timeline"]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/allocations": {
      "get": {
        "tags": ["Allocations"],
        "summary": "List all allocations in a ledger",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of allocations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "resourceId": {
                            "type": "string"
                          },
                          "bookingId": {
                            "type": ["string", "null"]
                          },
                          "active": {
                            "type": "boolean"
                          },
                          "startTime": {
                            "type": "string"
                          },
                          "endTime": {
                            "type": "string"
                          },
                          "buffer": {
                            "type": "object",
                            "properties": {
                              "beforeMs": {
                                "type": "number"
                              },
                              "afterMs": {
                                "type": "number"
                              }
                            },
                            "required": ["beforeMs", "afterMs"]
                          },
                          "expiresAt": {
                            "type": ["string", "null"]
                          },
                          "metadata": {
                            "type": ["object", "null"],
                            "additionalProperties": {}
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "ledgerId",
                          "resourceId",
                          "bookingId",
                          "active",
                          "startTime",
                          "endTime",
                          "buffer",
                          "expiresAt",
                          "metadata",
                          "createdAt",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Allocations"],
        "summary": "Create a new allocation",
        "description": "Creates a raw allocation for a resource. Use bookings for policy-evaluated reservations with lifecycle management. Supports idempotency via the Idempotency-Key header.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "resourceId": {
                    "type": "string",
                    "example": "rsc_01abc123def456ghi789jkl012"
                  },
                  "startTime": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "expiresAt": {
                    "type": ["string", "null"],
                    "format": "date-time",
                    "description": "If set, the allocation auto-expires after this time"
                  },
                  "metadata": {
                    "type": ["object", "null"],
                    "additionalProperties": {}
                  }
                },
                "required": ["resourceId", "startTime", "endTime"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Allocation created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "resourceId": {
                          "type": "string"
                        },
                        "bookingId": {
                          "type": ["string", "null"]
                        },
                        "active": {
                          "type": "boolean"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "endTime": {
                          "type": "string"
                        },
                        "buffer": {
                          "type": "object",
                          "properties": {
                            "beforeMs": {
                              "type": "number"
                            },
                            "afterMs": {
                              "type": "number"
                            }
                          },
                          "required": ["beforeMs", "afterMs"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "resourceId",
                        "bookingId",
                        "active",
                        "startTime",
                        "endTime",
                        "buffer",
                        "expiresAt",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "409": {
            "description": "Allocation conflicts with existing allocation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/allocations/{id}": {
      "get": {
        "tags": ["Allocations"],
        "summary": "Get an allocation by ID",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Allocation details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "resourceId": {
                          "type": "string"
                        },
                        "bookingId": {
                          "type": ["string", "null"]
                        },
                        "active": {
                          "type": "boolean"
                        },
                        "startTime": {
                          "type": "string"
                        },
                        "endTime": {
                          "type": "string"
                        },
                        "buffer": {
                          "type": "object",
                          "properties": {
                            "beforeMs": {
                              "type": "number"
                            },
                            "afterMs": {
                              "type": "number"
                            }
                          },
                          "required": ["beforeMs", "afterMs"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "resourceId",
                        "bookingId",
                        "active",
                        "startTime",
                        "endTime",
                        "buffer",
                        "expiresAt",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Allocation not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Allocations"],
        "summary": "Delete an allocation",
        "description": "Deletes a raw allocation. Allocations that belong to a booking cannot be deleted directly â€” cancel the booking instead.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "Allocation deleted"
          },
          "404": {
            "description": "Allocation not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "409": {
            "description": "Allocation belongs to a booking",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/services": {
      "get": {
        "tags": ["Services"],
        "summary": "List all services in a ledger",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of services",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "policyId": {
                            "type": ["string", "null"]
                          },
                          "resourceIds": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "metadata": {
                            "type": ["object", "null"],
                            "additionalProperties": {}
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "ledgerId",
                          "name",
                          "policyId",
                          "resourceIds",
                          "metadata",
                          "createdAt",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Services"],
        "summary": "Create a new service",
        "description": "Creates a service that groups resources with an optional scheduling policy.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Service name",
                    "example": "Haircut"
                  },
                  "policyId": {
                    "type": ["string", "null"],
                    "description": "Policy to enforce on bookings"
                  },
                  "resourceIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Resources that belong to this service",
                    "example": ["rsc_01abc123def456ghi789jkl012"]
                  },
                  "metadata": {
                    "type": ["object", "null"],
                    "additionalProperties": {}
                  }
                },
                "required": ["name"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Service created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "resourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "name",
                        "policyId",
                        "resourceIds",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Policy or resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/services/{id}": {
      "get": {
        "tags": ["Services"],
        "summary": "Get a service by ID",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Service details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "resourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "name",
                        "policyId",
                        "resourceIds",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Service not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Services"],
        "summary": "Update a service",
        "description": "Replaces the full service definition including name, policy, and resource assignments.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Service name",
                    "example": "Haircut"
                  },
                  "policyId": {
                    "type": ["string", "null"],
                    "description": "Policy to enforce on bookings"
                  },
                  "resourceIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Resources that belong to this service",
                    "example": ["rsc_01abc123def456ghi789jkl012"]
                  },
                  "metadata": {
                    "type": ["object", "null"],
                    "additionalProperties": {}
                  }
                },
                "required": ["name"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Service updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "resourceIds": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "name",
                        "policyId",
                        "resourceIds",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Service, policy, or resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Services"],
        "summary": "Delete a service",
        "description": "Deletes a service. Fails if the service has bookings in hold or confirmed status.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "Service deleted"
          },
          "404": {
            "description": "Service not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "409": {
            "description": "Service has active bookings",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/services/{id}/availability/slots": {
      "post": {
        "tags": ["Service Availability"],
        "summary": "Query available booking slots",
        "description": "Returns discrete grid-aligned time slots for appointment-style booking. Applies the service's policy (schedule, duration, grid, buffers, lead time) and filters by existing allocations. Pass includeUnavailable: true to get the full grid with available/unavailable status.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "startTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Start of the query window (ISO 8601)",
                    "example": "2026-03-02T00:00:00Z"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "End of the query window (ISO 8601). Max 7 days from startTime.",
                    "example": "2026-03-07T00:00:00Z"
                  },
                  "durationMs": {
                    "type": "integer",
                    "exclusiveMinimum": 0,
                    "description": "Desired booking duration in milliseconds",
                    "example": 3600000
                  },
                  "resourceIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Filter to specific resources. Defaults to all resources in the service."
                  },
                  "includeUnavailable": {
                    "type": "boolean",
                    "description": "Return all grid positions with status. Defaults to false."
                  }
                },
                "required": ["startTime", "endTime", "durationMs"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Available slots per resource",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "resourceId": {
                            "type": "string"
                          },
                          "timezone": {
                            "type": "string"
                          },
                          "slots": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "startTime": {
                                  "type": "string"
                                },
                                "endTime": {
                                  "type": "string"
                                },
                                "status": {
                                  "type": "string",
                                  "enum": ["available", "unavailable"]
                                }
                              },
                              "required": ["startTime", "endTime"]
                            }
                          }
                        },
                        "required": ["resourceId", "timezone", "slots"]
                      }
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data", "meta"]
                }
              }
            }
          },
          "404": {
            "description": "Service not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "422": {
            "description": "Invalid input (range too large, invalid resourceIds, etc.)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/services/{id}/availability/windows": {
      "post": {
        "tags": ["Service Availability"],
        "summary": "Query available time windows",
        "description": "Returns continuous available time ranges for rental-style booking. Applies the service's policy and subtracts existing allocations (with buffer-aware gap shrinkage). Pass includeUnavailable: true to get the full schedule with available/unavailable status.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "startTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Start of the query window (ISO 8601)",
                    "example": "2026-03-02T00:00:00Z"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "End of the query window (ISO 8601). Max 31 days from startTime.",
                    "example": "2026-03-07T00:00:00Z"
                  },
                  "resourceIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Filter to specific resources. Defaults to all resources in the service."
                  },
                  "includeUnavailable": {
                    "type": "boolean",
                    "description": "Return full schedule with status. Defaults to false."
                  }
                },
                "required": ["startTime", "endTime"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Available windows per resource",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "resourceId": {
                            "type": "string"
                          },
                          "timezone": {
                            "type": "string"
                          },
                          "windows": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "startTime": {
                                  "type": "string"
                                },
                                "endTime": {
                                  "type": "string"
                                },
                                "status": {
                                  "type": "string",
                                  "enum": ["available", "unavailable"]
                                }
                              },
                              "required": ["startTime", "endTime"]
                            }
                          }
                        },
                        "required": ["resourceId", "timezone", "windows"]
                      }
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data", "meta"]
                }
              }
            }
          },
          "404": {
            "description": "Service not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "422": {
            "description": "Invalid input (range too large, invalid resourceIds, etc.)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/bookings": {
      "get": {
        "tags": ["Bookings"],
        "summary": "List all bookings in a ledger",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of bookings",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "serviceId": {
                            "type": "string"
                          },
                          "policyId": {
                            "type": ["string", "null"]
                          },
                          "status": {
                            "type": "string",
                            "enum": ["hold", "confirmed", "canceled", "expired"]
                          },
                          "expiresAt": {
                            "type": ["string", "null"]
                          },
                          "allocations": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "resourceId": {
                                  "type": "string"
                                },
                                "startTime": {
                                  "type": "string"
                                },
                                "endTime": {
                                  "type": "string"
                                },
                                "buffer": {
                                  "type": "object",
                                  "properties": {
                                    "beforeMs": {
                                      "type": "number"
                                    },
                                    "afterMs": {
                                      "type": "number"
                                    }
                                  },
                                  "required": ["beforeMs", "afterMs"]
                                },
                                "active": {
                                  "type": "boolean"
                                }
                              },
                              "required": [
                                "id",
                                "resourceId",
                                "startTime",
                                "endTime",
                                "buffer",
                                "active"
                              ]
                            }
                          },
                          "metadata": {
                            "type": ["object", "null"],
                            "additionalProperties": {}
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "ledgerId",
                          "serviceId",
                          "policyId",
                          "status",
                          "expiresAt",
                          "allocations",
                          "metadata",
                          "createdAt",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Bookings"],
        "summary": "Create a new booking",
        "description": "Creates a booking for a service. Evaluates the service's policy, checks for conflicts, and creates the underlying allocation. When the policy defines buffers, the allocation's startTime/endTime represent the buffer-expanded blocked window. The original customer time can be derived using buffer.beforeMs and buffer.afterMs on the allocation. Supports idempotency via the Idempotency-Key header.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "serviceId": {
                    "type": "string",
                    "example": "svc_01abc123def456ghi789jkl012"
                  },
                  "resourceId": {
                    "type": "string",
                    "example": "rsc_01abc123def456ghi789jkl012"
                  },
                  "startTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2026-01-15T10:00:00Z"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2026-01-15T11:00:00Z"
                  },
                  "status": {
                    "type": "string",
                    "enum": ["hold", "confirmed"],
                    "default": "hold",
                    "description": "Initial status. Hold creates a temporary reservation."
                  },
                  "metadata": {
                    "type": ["object", "null"],
                    "additionalProperties": {}
                  }
                },
                "required": ["serviceId", "resourceId", "startTime", "endTime"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Booking created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "serviceId": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "status": {
                          "type": "string",
                          "enum": ["hold", "confirmed", "canceled", "expired"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "allocations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "resourceId": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "endTime": {
                                "type": "string"
                              },
                              "buffer": {
                                "type": "object",
                                "properties": {
                                  "beforeMs": {
                                    "type": "number"
                                  },
                                  "afterMs": {
                                    "type": "number"
                                  }
                                },
                                "required": ["beforeMs", "afterMs"]
                              },
                              "active": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "resourceId",
                              "startTime",
                              "endTime",
                              "buffer",
                              "active"
                            ]
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "serviceId",
                        "policyId",
                        "status",
                        "expiresAt",
                        "allocations",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Service or resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "409": {
            "description": "Conflict (overlap, policy rejected, or resource not in service)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/bookings/{id}": {
      "get": {
        "tags": ["Bookings"],
        "summary": "Get a booking by ID",
        "description": "Returns the booking with its nested allocations.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Booking details with allocations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "serviceId": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "status": {
                          "type": "string",
                          "enum": ["hold", "confirmed", "canceled", "expired"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "allocations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "resourceId": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "endTime": {
                                "type": "string"
                              },
                              "buffer": {
                                "type": "object",
                                "properties": {
                                  "beforeMs": {
                                    "type": "number"
                                  },
                                  "afterMs": {
                                    "type": "number"
                                  }
                                },
                                "required": ["beforeMs", "afterMs"]
                              },
                              "active": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "resourceId",
                              "startTime",
                              "endTime",
                              "buffer",
                              "active"
                            ]
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "serviceId",
                        "policyId",
                        "status",
                        "expiresAt",
                        "allocations",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Booking not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/bookings/{id}/confirm": {
      "post": {
        "tags": ["Bookings"],
        "summary": "Confirm a held booking",
        "description": "Confirms a booking that is in hold status. Idempotent â€” confirming an already confirmed booking returns success. Supports idempotency via the Idempotency-Key header.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Booking confirmed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "serviceId": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "status": {
                          "type": "string",
                          "enum": ["hold", "confirmed", "canceled", "expired"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "allocations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "resourceId": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "endTime": {
                                "type": "string"
                              },
                              "buffer": {
                                "type": "object",
                                "properties": {
                                  "beforeMs": {
                                    "type": "number"
                                  },
                                  "afterMs": {
                                    "type": "number"
                                  }
                                },
                                "required": ["beforeMs", "afterMs"]
                              },
                              "active": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "resourceId",
                              "startTime",
                              "endTime",
                              "buffer",
                              "active"
                            ]
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "serviceId",
                        "policyId",
                        "status",
                        "expiresAt",
                        "allocations",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Booking not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "409": {
            "description": "Booking cannot be confirmed (expired or invalid state)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/bookings/{id}/cancel": {
      "post": {
        "tags": ["Bookings"],
        "summary": "Cancel a booking",
        "description": "Cancels a booking in hold or confirmed status. Idempotent â€” canceling an already canceled booking returns success. Supports idempotency via the Idempotency-Key header.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Booking canceled",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "serviceId": {
                          "type": "string"
                        },
                        "policyId": {
                          "type": ["string", "null"]
                        },
                        "status": {
                          "type": "string",
                          "enum": ["hold", "confirmed", "canceled", "expired"]
                        },
                        "expiresAt": {
                          "type": ["string", "null"]
                        },
                        "allocations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "resourceId": {
                                "type": "string"
                              },
                              "startTime": {
                                "type": "string"
                              },
                              "endTime": {
                                "type": "string"
                              },
                              "buffer": {
                                "type": "object",
                                "properties": {
                                  "beforeMs": {
                                    "type": "number"
                                  },
                                  "afterMs": {
                                    "type": "number"
                                  }
                                },
                                "required": ["beforeMs", "afterMs"]
                              },
                              "active": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "id",
                              "resourceId",
                              "startTime",
                              "endTime",
                              "buffer",
                              "active"
                            ]
                          }
                        },
                        "metadata": {
                          "type": ["object", "null"],
                          "additionalProperties": {}
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "serviceId",
                        "policyId",
                        "status",
                        "expiresAt",
                        "allocations",
                        "metadata",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "meta": {
                      "type": "object",
                      "properties": {
                        "serverTime": {
                          "type": "string"
                        }
                      },
                      "required": ["serverTime"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Booking not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          },
          "409": {
            "description": "Booking cannot be canceled (invalid state)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/webhooks": {
      "get": {
        "tags": ["Webhooks"],
        "summary": "List webhook subscriptions",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of webhook subscriptions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "url": {
                            "type": "string"
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": ["id", "ledgerId", "url", "createdAt", "updatedAt"]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Webhooks"],
        "summary": "Create a webhook subscription",
        "description": "Creates a new webhook subscription. The secret is only returned once at creation time.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "example": "https://example.com/webhook"
                  }
                },
                "required": ["url"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Webhook subscription created (includes secret)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        },
                        "secret": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "ledgerId", "url", "createdAt", "updatedAt", "secret"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/webhooks/{id}": {
      "patch": {
        "tags": ["Webhooks"],
        "summary": "Update a webhook subscription",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "format": "uri"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Webhook subscription updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "ledgerId", "url", "createdAt", "updatedAt"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Webhook subscription not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Webhooks"],
        "summary": "Delete a webhook subscription",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "Webhook subscription deleted"
          },
          "404": {
            "description": "Webhook subscription not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/webhooks/{id}/rotate-secret": {
      "post": {
        "tags": ["Webhooks"],
        "summary": "Rotate webhook secret",
        "description": "Generates a new secret for the webhook subscription. The old secret is invalidated immediately.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "New secret generated (includes secret)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        },
                        "secret": {
                          "type": "string"
                        }
                      },
                      "required": ["id", "ledgerId", "url", "createdAt", "updatedAt", "secret"]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Webhook subscription not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/policies": {
      "get": {
        "tags": ["Policies"],
        "summary": "List policies for a ledger",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "List of policies",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "ledgerId": {
                            "type": "string"
                          },
                          "config": {
                            "type": "object",
                            "additionalProperties": {}
                          },
                          "configHash": {
                            "type": "string"
                          },
                          "createdAt": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "ledgerId",
                          "config",
                          "configHash",
                          "createdAt",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Policies"],
        "summary": "Create a policy",
        "description": "Creates a new scheduling policy for the ledger. The config is provided in authoring format (friendly units like minutes/hours) and stored in canonical format (milliseconds).",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "config": {
                    "type": "object",
                    "properties": {
                      "schema_version": {
                        "type": "number",
                        "enum": [1]
                      },
                      "default": {
                        "type": "string",
                        "enum": ["open", "closed"]
                      },
                      "config": {
                        "type": "object",
                        "properties": {},
                        "additionalProperties": {}
                      },
                      "rules": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {},
                          "additionalProperties": {}
                        }
                      }
                    },
                    "required": ["schema_version", "default", "config"],
                    "additionalProperties": {},
                    "description": "Policy configuration in authoring format"
                  }
                },
                "required": ["config"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Policy created (may include warnings)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "config": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "configHash": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "config",
                        "configHash",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ledgers/{ledgerId}/policies/{id}": {
      "get": {
        "tags": ["Policies"],
        "summary": "Get a policy by ID",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Policy details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "config": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "configHash": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "config",
                        "configHash",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Policy not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Policies"],
        "summary": "Update a policy",
        "description": "Replaces the full policy configuration. The config is re-normalized, re-validated, and re-hashed.",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "config": {
                    "type": "object",
                    "properties": {
                      "schema_version": {
                        "type": "number",
                        "enum": [1]
                      },
                      "default": {
                        "type": "string",
                        "enum": ["open", "closed"]
                      },
                      "config": {
                        "type": "object",
                        "properties": {},
                        "additionalProperties": {}
                      },
                      "rules": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {},
                          "additionalProperties": {}
                        }
                      }
                    },
                    "required": ["schema_version", "default", "config"],
                    "additionalProperties": {},
                    "description": "Policy configuration in authoring format"
                  }
                },
                "required": ["config"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Policy updated (may include warnings)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "ledgerId": {
                          "type": "string"
                        },
                        "config": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "configHash": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "ledgerId",
                        "config",
                        "configHash",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": ["data"]
                }
              }
            }
          },
          "404": {
            "description": "Policy not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Policies"],
        "summary": "Delete a policy",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "ledgerId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "Policy deleted"
          },
          "404": {
            "description": "Policy not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "details": {
                          "type": "object",
                          "additionalProperties": {}
                        },
                        "issues": {
                          "type": "array",
                          "items": {}
                        }
                      },
                      "required": ["code", "message"]
                    }
                  },
                  "required": ["error"]
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}
